flowchart LR
    A[User Request] --> B[Search Recipes]
    B --> C{Meets Criteria?}
    C -->|No| B
    C -->|Yes| D[Select Recipe]
    D --> E[Extract Ingredients]
    E --> F{Allergen Conflict?}
    F -->|No| G[Generate Grocery List]
    G --> H[Present to User]
    H --> I{Has items already?}
    I -->|Yes| J[Remove and Regenerate]
    J --> H
    I -->|Done| K[Final List]
    F -->|Yes| L[STOP Ask User]
    L -->|Substitute| E
    L -->|New Recipe| B
    style L fill:#ffcccc,stroke:#cc0000
    style F fill:#fff3cd,stroke:#cc9900
    style K fill:#d4edda,stroke:#28a745
